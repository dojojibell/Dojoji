{"ast":null,"code":"var _jsxFileName = \"/Users/ivopascoal/Desktop/Dojoji/src/contexts/wallet.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useState, useEffect, useContext, createContext, useCallback } from 'react';\nimport { ethers } from 'ethers';\nimport { CACHE_WALLET_KEY, NETWORK_MAINNET } from 'config';\nimport cache from 'utils/cache';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WalletContext = /*#__PURE__*/createContext(null);\nexport const WalletProvider = ({\n  children\n}) => {\n  _s();\n\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [network, setNetwork] = useState(null);\n  const [signer, setSigner] = useState(null);\n  const [address, setAddress] = useState(null);\n  const startConnecting = useCallback(() => setIsConnecting(true), [setIsConnecting]);\n  const stopConnecting = useCallback(() => setIsConnecting(false), [setIsConnecting]);\n  const setProvider = useCallback(async web3Provider => {\n    web3Provider.on('accountsChanged', () => {\n      window.location.reload();\n    });\n    web3Provider.on('chainChanged', () => {\n      window.location.reload();\n    }); // web3Provider.on('disconnect', () => {\n    //   disconnect();\n    // });\n\n    const provider = new ethers.providers.Web3Provider(web3Provider);\n    const {\n      name: network\n    } = await provider.getNetwork();\n    setNetwork(~['homestead'].indexOf(network) ? NETWORK_MAINNET : network);\n    const signer = provider.getSigner();\n    setSigner(signer);\n    setAddress(await signer.getAddress());\n    stopConnecting();\n  }, [stopConnecting]);\n  const connectMetamask = useCallback(async () => {\n    if (!window.ethereum) return;\n    await window.ethereum.enable();\n    cache(CACHE_WALLET_KEY, 'metamask');\n    await setProvider(window.ethereum);\n  }, [setProvider]);\n\n  async function disconnect() {\n    cache(CACHE_WALLET_KEY, null);\n    setSigner(null);\n    setAddress(null);\n    setNetwork(null);\n  }\n\n  useEffect(() => {\n    const load = async () => {\n      if (address) return;\n      const cachedWallet = cache(CACHE_WALLET_KEY);\n\n      if (cachedWallet) {\n        var _c$cachedWallet;\n\n        const c = {\n          metamask: connectMetamask\n        };\n        (_c$cachedWallet = c[cachedWallet]) === null || _c$cachedWallet === void 0 ? void 0 : _c$cachedWallet.call(c);\n      }\n    };\n\n    load();\n  }, [address, connectMetamask]);\n  return /*#__PURE__*/_jsxDEV(WalletContext.Provider, {\n    value: {\n      network,\n      signer,\n      address,\n      isConnecting,\n      startConnecting,\n      stopConnecting,\n      disconnect,\n      connectMetamask\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n\n_s(WalletProvider, \"7bV7B8jAWbW5CmIi1bsz0le/U8A=\");\n\n_c = WalletProvider;\nexport function useWallet() {\n  _s2();\n\n  const context = useContext(WalletContext);\n\n  if (!context) {\n    throw new Error('Missing Wallet context');\n  }\n\n  const {\n    network,\n    signer,\n    address,\n    isConnecting,\n    startConnecting,\n    stopConnecting,\n    disconnect,\n    connectMetamask\n  } = context;\n  return {\n    network,\n    signer,\n    address,\n    isConnecting,\n    startConnecting,\n    stopConnecting,\n    disconnect,\n    connectMetamask\n  };\n}\n\n_s2(useWallet, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"WalletProvider\");","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/Dojoji/src/contexts/wallet.tsx"],"names":["useState","useEffect","useContext","createContext","useCallback","ethers","CACHE_WALLET_KEY","NETWORK_MAINNET","cache","WalletContext","WalletProvider","children","isConnecting","setIsConnecting","network","setNetwork","signer","setSigner","address","setAddress","startConnecting","stopConnecting","setProvider","web3Provider","on","window","location","reload","provider","providers","Web3Provider","name","getNetwork","indexOf","getSigner","getAddress","connectMetamask","ethereum","enable","disconnect","load","cachedWallet","c","metamask","useWallet","context","Error"],"mappings":"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","sourcesContent":["import {\n  FC,\n  useState,\n  useEffect,\n  useContext,\n  createContext,\n  ReactNode,\n  useCallback,\n} from 'react';\nimport { ethers } from 'ethers';\nimport { CACHE_WALLET_KEY, NETWORK_MAINNET } from 'config';\nimport cache from 'utils/cache';\n\nconst WalletContext = createContext<{\n  network: string | null;\n\n  signer: ethers.Signer | null;\n  address: string | null;\n\n  isConnecting: boolean;\n  startConnecting: () => void;\n  stopConnecting: () => void;\n  disconnect: () => void;\n\n  connectMetamask: () => void;\n} | null>(null);\n\nexport const WalletProvider: FC<{ children: ReactNode }> = ({ children }) => {\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [network, setNetwork] = useState<string | null>(null);\n  const [signer, setSigner] = useState<ethers.Signer | null>(null);\n  const [address, setAddress] = useState<string | null>(null);\n\n  const startConnecting = useCallback(() => setIsConnecting(true), [\n    setIsConnecting,\n  ]);\n  const stopConnecting = useCallback(() => setIsConnecting(false), [\n    setIsConnecting,\n  ]);\n\n  const setProvider = useCallback(\n    async (web3Provider: any) => {\n      web3Provider.on('accountsChanged', () => {\n        window.location.reload();\n      });\n      web3Provider.on('chainChanged', () => {\n        window.location.reload();\n      });\n      // web3Provider.on('disconnect', () => {\n      //   disconnect();\n      // });\n      const provider = new ethers.providers.Web3Provider(web3Provider);\n\n      const { name: network } = await provider.getNetwork();\n      setNetwork(~['homestead'].indexOf(network) ? NETWORK_MAINNET : network);\n\n      const signer = provider.getSigner();\n      setSigner(signer);\n      setAddress(await signer.getAddress());\n      stopConnecting();\n    },\n    [stopConnecting]\n  );\n\n  const connectMetamask = useCallback(async () => {\n    if (!window.ethereum) return;\n    await window.ethereum.enable();\n    cache(CACHE_WALLET_KEY, 'metamask');\n    await setProvider(window.ethereum);\n  }, [setProvider]);\n\n  async function disconnect() {\n    cache(CACHE_WALLET_KEY, null);\n    setSigner(null);\n    setAddress(null);\n    setNetwork(null);\n  }\n\n  useEffect(() => {\n    const load = async () => {\n      if (address) return;\n\n      const cachedWallet = cache(CACHE_WALLET_KEY);\n      if (cachedWallet) {\n        const c: Record<string, () => void> = {\n          metamask: connectMetamask,\n        };\n        c[cachedWallet]?.();\n      }\n    };\n\n    load();\n  }, [address, connectMetamask]);\n\n  return (\n    <WalletContext.Provider\n      value={{\n        network,\n\n        signer,\n        address,\n\n        isConnecting,\n        startConnecting,\n        stopConnecting,\n        disconnect,\n\n        connectMetamask,\n      }}\n    >\n      {children}\n    </WalletContext.Provider>\n  );\n};\n\nexport function useWallet() {\n  const context = useContext(WalletContext);\n  if (!context) {\n    throw new Error('Missing Wallet context');\n  }\n  const {\n    network,\n\n    signer,\n    address,\n\n    isConnecting,\n    startConnecting,\n    stopConnecting,\n    disconnect,\n\n    connectMetamask,\n  } = context;\n\n  return {\n    network,\n\n    signer,\n    address,\n\n    isConnecting,\n    startConnecting,\n    stopConnecting,\n    disconnect,\n\n    connectMetamask,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}